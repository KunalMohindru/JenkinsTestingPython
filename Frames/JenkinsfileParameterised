pipeline {
    agent any

    parameters {
        choice(name: 'browser_name', choices: ['chrome', 'edge', 'headless'])
    }

    stages {

        stage('Create Virtual Environment') {
            steps {
                    // Create a virtual environment
                    bat 'python -m venv virtual_environment'
                    // Activate the virtual environment (Linux/Mac example)
                    bat 'source virtual_environment/bin/activate'
            }
        }

        stage('Install dependencies') {
            steps {
                bat """
                pip install -r Frames\\requirements.txt
                """
            }
        }  

        stage('print') {
            steps {
                echo "Running tests with ${params.browser_name} mode"
            }
        }            

        stage('Run Tests') {

            steps {
                bat """
                pytest -s -v --browser_name=${params.browser_name} Frames\\Test\\test_google.py
                """
            }
        }

        stage('Deactivate and delete virtual environment') {

            steps {
                // deactivate the virtual environment before deleting it
                bat 'deactivate'
                // remove the virtual env
                bat 'rm -rf venv'
            }
        }

        
    }
}
